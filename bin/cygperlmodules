#!/usr/bin/env bash
set -o pipefail
set -o nounset
set -o errexit

TAB=$'\t'
SPACETAB=" "$'\t'
CR=$'\r'

fe -h -E -e '^['"$SPACETAB"']*use['"$SPACETAB"']+' "$@" |
    sed -r -e 's/^['"$SPACETAB"']+//' -e 's/'"$CR"'//' |
    grep -E -v \
	 -e '^use['"$SPACETAB"']+(utf8|POSIX|strict|vars|warnings|open|constant|base|feature|lib|mro|locale)['"$SPACETAB"';]' \
	 -e '^use['"$SPACETAB"']+(v5\.|My::)' |
    sed -r \
	-e 's/;.*/;/' \
	-e 's/['"$SPACETAB"']+qw\([^\(\)]*\)//' \
	-e 's/['"$SPACETAB"']+qw\(.*/;/' \
	-e 's/['"$SPACETAB"']+[\(\-].*/;/' \
	-e 's/['"$SPACETAB"']+$//' \
	-e 's/\s+[0-9]+\.[0-9]+;/;/' |
    sort | uniq
