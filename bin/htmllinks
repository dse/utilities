#!/usr/bin/env perl
use warnings;
use strict;

use HTML::LinkExtor;

if (!scalar @ARGV) {
    run(\*STDIN);
} else {
    foreach my $arg (@ARGV) {
        run($arg);
    }
}

sub run {
    my ($source) = @_;
    my $filename;
    my $callback = sub {
        my ($tag, %links) = @_;
        foreach my $key (sort keys %links) {
            print(join("\t", $filename, $tag, $key, $links{$key}), "\n");
        }
    };
    my $extor = HTML::LinkExtor->new($callback);
    if ($source eq \*STDIN) {
        $filename = '-';
        $extor->parse_file($source);
    } elsif ($source->isa('IO::Handle')) {
        $filename = "$source";
        $extor->parse_file($source);
    } else {
        $filename = $source;
        $extor->parse_file($filename);
    }
}
