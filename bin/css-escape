#!/usr/bin/env perl
use warnings;
use strict;
use v5.10.0;

#------------------------------------------------------------------------------
use open IO => qw(:locale);
use Encode::Locale;
use Encode qw(decode);
BEGIN {
    @ARGV = map { decode('locale', $_, Encode::FB_CROAK) } @ARGV;
}

#------------------------------------------------------------------------------
while (<>) {
    s{([^\x20-\x7f\r\n\t])(?=([[:xdigit:][:space:]]?))}
     {say STDERR "\$1 <$1> \$2 <$2>";
      '\\' . sprintf('%04x', ord($1)) . (($2 ne '') ? ' ' : '')}gxe;
    print $_;
}
