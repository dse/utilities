#!/usr/bin/env perl
use warnings;
use strict;

select STDOUT;
$| = 1;

my $ST  = "\e\\";               # string terminator
my $OSC = "\e]";                # operating system command

my %solarizedColors = (
    base03  => '#002b36',       # 0 43 54
    base02  => '#073642',       # 7 54 66
    base01  => '#586e75',       # 88 110 117
    base00  => '#657b83',       # 101 123 131
    base0   => '#839496',       # 131 148 150
    base1   => '#93a1a1',       # 147 161 161
    base2   => '#eee8d5',       # 238 232 213
    base3   => '#fdf6e3',       # 253 246 227
    yellow  => '#b58900',       # 181 137 0
    orange  => '#cb4b16',       # 203 75 22
    red     => '#dc322f',       # 220 50 47
    magenta => '#d33682',       # 211 54 130
    violet  => '#6c71c4',       # 108 113 196
    blue    => '#268bd2',       # 38 139 210
    cyan    => '#2aa198',       # 42 161 152
    green   => '#859900',       # 133 153 0
);

my $themes = {};

$themes->{'solarized-dark'} = {
    0                   => $solarizedColors{base02},
    1                   => $solarizedColors{red},
    2                   => $solarizedColors{green},
    3                   => $solarizedColors{yellow},
    4                   => $solarizedColors{blue},
    5                   => $solarizedColors{magenta},
    6                   => $solarizedColors{cyan},
    7                   => $solarizedColors{base2},
    8                   => $solarizedColors{base03},
    9                   => $solarizedColors{orange},
    10                  => $solarizedColors{base01},
    11                  => $solarizedColors{base00},
    12                  => $solarizedColors{base0},
    13                  => $solarizedColors{violet},
    14                  => $solarizedColors{base1},
    15                  => $solarizedColors{base3},
    foreground          => $solarizedColors{base0},
    background          => $solarizedColors{base03},
    highlightForeground => $solarizedColors{base1},
    highlightBackground => $solarizedColors{base02},
    cursor              => '#0f4999',
};

$themes->{'solarized-dark-2'} = {
    %{$themes->{'solarized-dark'}},
    foreground          => $solarizedColors{base1},
    background          => $solarizedColors{base02},
    highlightForeground => $solarizedColors{base2},
    highlightBackground => $solarizedColors{base01},
};

$themes->{'solarized-light'} = {
    %{$themes->{'solarized-dark'}},
    0                   => $solarizedColors{base2},
    7                   => $solarizedColors{base02},
    8                   => $solarizedColors{base3},
    10                  => $solarizedColors{base1},
    11                  => $solarizedColors{base0},
    12                  => $solarizedColors{base00},
    14                  => $solarizedColors{base01},
    15                  => $solarizedColors{base03},
    foreground          => $solarizedColors{base00},
    background          => $solarizedColors{base3},
    highlightForeground => $solarizedColors{base01},
    highlightBackground => $solarizedColors{base2},
};

$themes->{'solarized-light-2'} = {
    %{$themes->{'solarized-light'}},
    foreground          => $solarizedColors{base01},
    background          => $solarizedColors{base2},
    highlightForeground => $solarizedColors{base02},
    highlightBackground => $solarizedColors{base1},
};

$themes->{'zenburn'} = {
    #                        1 2 4
    #                        ------
    0                   => '#1f1f1f', # black
    1                   => '#cc9393', # red
    2                   => '#5f7f5f', # green
    3                   => '#ffd7a7', # brown
    4                   => '#8cb0d3', # blue
    5                   => '#8f8f8f', # magenta
    6                   => '#71d3b4', # cyan
    7                   => '#dfe4cf', # white
    8                   => '#6f6f6f', # dark gray
    9                   => '#ecb3b3', # bright red
    10                  => '#ffd7a7', # bright green
    11                  => '#8cb0d3', # bright yellow
    12                  => '#8f8f8f', # bright blue
    13                  => '#71d3b4', # bright magenta
    14                  => '#dfe4cf', # bright cyan
    15                  => '#ffcfaf', # bright white
    foreground          => '#dcdccc',
    background          => '#3f3f3f',
    highlightForeground => '#ffffef',
    highlightBackground => '#1f1f1f',
    cursor              => '#8faf9f',
};

$themes->{easy} = {
    #                        1 2 4
    #                        ------
    0                   => '#000000', # black
    1                   => '#cc3333', # red
    2                   => '#339933', # green
    3                   => '#999933', # brown
    4                   => '#333399', # blue
    5                   => '#993399', # magenta
    6                   => '#339999', # cyan
    7                   => '#999999', # white
    8                   => '#444444', # dark gray
    9                   => '#ff3333', # bright red
    10                  => '#33cc33', # bright green
    11                  => '#cccc33', # bright yellow
    12                  => '#3333cc', # bright blue
    13                  => '#cc33cc', # bright magenta
    14                  => '#33cccc', # bright cyan
    15                  => '#cccccc', # bright white
    foreground          => '#bbbbbb',
    background          => '#333333',
    highlightForeground => '#ffffff',
    highlightBackground => '#000000',
    cursor              => '#ff9933',
};

$themes->{greenscreen} = {
    %{$themes->{easy}},
    foreground          => '#11cc11',
    background          => '#113311',
    highlightForeground => '#22ff22',
    highlightBackground => '#116611',
    cursor              => '#55ff55',
};

# from mintty
$themes->{'dracula'} = {
    'foreground'             => '#f8f8f2',
    'background'             => '#282a36',
    '0'                      => '#000000',
    '8'                      => '#686868',
    '1'                      => '#ff5555',
    '9'                      => '#ff6e67',
    '2'                      => '#50fa7b',
    '10'                     => '#5af78e',
    '3'                      => '#f1fa8c',
    '11'                     => '#f4f99d',
    '4'                      => '#caa9fa',
    '12'                     => '#caa9fa',
    '5'                      => '#ff79c6',
    '13'                     => '#ff92d0',
    '6'                      => '#8be9fd',
    '14'                     => '#9aedfe',
    '7'                      => '#bfbfbf',
    '15'                     => '#e6e6e6',
};
$themes->{'flat-ui'} = {
    'foreground'             => '#ecf0f1',
    'background'             => '#181818',
    'cursor'                 => '#d35400',
    '8'                      => '#34495e',
    '0'                      => '#2c3e50',
    '9'                      => '#e74c3c',
    '1'                      => '#c0392b',
    '10'                     => '#2ecc71',
    '2'                      => '#27ae60',
    '11'                     => '#f1c40f',
    '3'                      => '#f39c12',
    '12'                     => '#3498db',
    '4'                      => '#2980b9',
    '13'                     => '#9b59b6',
    '5'                      => '#8e44ad',
    '14'                     => '#1abc9c',
    '6'                      => '#7aa085',
    '15'                     => '#ecf0f1',
    '7'                      => '#bdc3c7',
};
$themes->{'gruvbox'} = {
    'foreground'             => '#ebdbb2',
    'background'             => '#1d2021',
    'cursor'                 => '#fd9d4f',
    '0'                      => '#282828',
    '8'                      => '#928374',
    '1'                      => '#cc241d',
    '9'                      => '#fb4934',
    '2'                      => '#98971a',
    '10'                     => '#b8bb26',
    '3'                      => '#d79921',
    '11'                     => '#fabd2f',
    '4'                      => '#458588',
    '12'                     => '#83a598',
    '5'                      => '#b16286',
    '13'                     => '#d3869b',
    '6'                      => '#689d6a',
    '14'                     => '#8ec07c',
    '7'                      => '#a89984',
    '15'                     => '#ebdbb2',
};
$themes->{'html'} = {
    '0'                      => '#000000',
    '1'                      => '#800000',
    '2'                      => '#008000',
    '3'                      => '#808000',
    '4'                      => '#000080',
    '5'                      => '#800080',
    '6'                      => '#008080',
    '7'                      => '#c0c0c0',
    '8'                      => '#808080',
    '9'                      => '#ff0000',
    '10'                     => '#00ff00',
    '11'                     => '#ffff00',
    '12'                     => '#0000ff',
    '13'                     => '#ff00ff',
    '14'                     => '#00ffff',
    '15'                     => '#ffffff',
};
$themes->{'mintty'} = {
    '0'                      => '#000000',
    '1'                      => '#bf0000',
    '2'                      => '#00bf00',
    '3'                      => '#bfbf00',
    '4'                      => '#0000bf',
    '5'                      => '#bf00bf',
    '6'                      => '#00bfbf',
    '7'                      => '#bfbfbf',
    '8'                      => '#404040',
    '9'                      => '#ff4040',
    '10'                     => '#40ff40',
    '11'                     => '#ffff40',
    '12'                     => '#6060ff',
    '13'                     => '#ff40ff',
    '14'                     => '#40ffff',
    '15'                     => '#ffffff',
};
$themes->{'nord'} = {
    'background'             => '#2e3440',
    'foreground'             => '#d8dee9',
    'cursor'                 => '#d8dee9',
    '0'                      => '#3b4252',
    '8'                      => '#4c566a',
    '1'                      => '#bf616a',
    '9'                      => '#bf616a',
    '2'                      => '#a3be8c',
    '10'                     => '#a3be8c',
    '3'                      => '#ebcb8b',
    '11'                     => '#ebcb8b',
    '4'                      => '#81a1c1',
    '12'                     => '#81a1c1',
    '5'                      => '#b48ead',
    '13'                     => '#b48ead',
    '6'                      => '#88c0d0',
    '14'                     => '#8fbcbb',
    '7'                      => '#e5e9f0',
    '15'                     => '#eceff4',
};
$themes->{'rosipov'} = {
    'foreground'             => '#839496',
    'background'             => '#000000',
    'cursor'                 => '#dc322f',
    '0'                      => '#073642',
    '8'                      => '#002b36',
    '1'                      => '#dc322f',
    '9'                      => '#cb4b16',
    '2'                      => '#00c884',
    '10'                     => '#00c884',
    '3'                      => '#cccc66',
    '11'                     => '#cccc66',
    '4'                      => '#6699cc',
    '12'                     => '#6699cc',
    '5'                      => '#d33682',
    '13'                     => '#6c71c4',
    '6'                      => '#2aa198',
    '14'                     => '#93a1a1',
    '7'                      => '#eee8d5',
    '15'                     => '#fdf6e3',
};
$themes->{'vga'} = {
    '0'                      => '#000000',
    '4'                      => '#0000aa',
    '2'                      => '#00aa00',
    '6'                      => '#00aaaa',
    '1'                      => '#aa0000',
    '5'                      => '#aa00aa',
    '3'                      => '#aa5500',
    '7'                      => '#aaaaaa',
    '8'                      => '#555555',
    '12'                     => '#5555ff',
    '10'                     => '#55ff55',
    '14'                     => '#55ffff',
    '9'                      => '#ff5555',
    '13'                     => '#ff55ff',
    '11'                     => '#ffff55',
    '15'                     => '#ffffff',
};
$themes->{'windows10'} = {
    '0'                      => '#0c0c0c',
    '4'                      => '#0037da',
    '2'                      => '#13a10e',
    '6'                      => '#3a96dd',
    '1'                      => '#c50f1f',
    '5'                      => '#881798',
    '3'                      => '#c19c00',
    '7'                      => '#cccccc',
    '8'                      => '#767676',
    '12'                     => '#3b78ff',
    '10'                     => '#16c60c',
    '14'                     => '#61d6d6',
    '9'                      => '#e74856',
    '13'                     => '#b4009e',
    '11'                     => '#f9f1a5',
    '15'                     => '#f2f2f2',
};
$themes->{'xterm'} = {
    '0'                      => '#000000',
    '1'                      => '#cd0000',
    '2'                      => '#00cd00',
    '3'                      => '#cdcd00',
    '4'                      => '#0000ee',
    '5'                      => '#cd00cd',
    '6'                      => '#00cdcd',
    '7'                      => '#e5e5e5',
    '8'                      => '#7f7f7f',
    '9'                      => '#ff0000',
    '10'                     => '#00ff00',
    '11'                     => '#ffff00',
    '12'                     => '#5c5cff',
    '13'                     => '#ff00ff',
    '14'                     => '#00ffff',
    '15'                     => '#ffffff',
};

my $theme = shift(@ARGV);
if (!defined $theme) {
    setColorScheme($themes->{'solarized-dark'});
    exit;
}

if ($theme eq 'themes') {
    print("$_\n") foreach sort keys %{$themes};
    exit;
}

if (exists $themes->{$theme}) {
    setColorScheme($themes->{$theme});
    exit;
}

die("unknown theme name: $theme\n");

sub setColorScheme {
    my $theme = shift;
    my %args = %$theme;

    for (my $i = 0; $i <= 15; $i += 1) {
        setColor($i, $args{$i});
    }
    setForeground($args{foreground} // $args{7});
    setBackground($args{background} // $args{0});
    setHighlightForeground($args{highlightForeground} // $args{15});
    setHighlightBackground($args{highlightBackground} // $args{8});
    setCursor($args{cursor} // $args{7});
}

sub setColor {
    my ($colorNumber, $colorValue) = @_;
    print "${OSC}4;${colorNumber};${colorValue}${ST}";
}
sub setForeground {
    my ($colorValue) = @_;
    print "${OSC}10;${colorValue}${ST}";
}
sub setBackground {
    my ($colorValue) = @_;
    print "${OSC}11;${colorValue}${ST}";
}
sub setCursor {
    my ($colorValue) = @_;
    print "${OSC}12;${colorValue}${ST}";
}
sub setHighlightForeground {
    my ($colorValue) = @_;
    print "${OSC}17;${colorValue}${ST}";
}
sub setHighlightBackground {
    my ($colorValue) = @_;
    print "${OSC}19;${colorValue}${ST}";
}
sub setBold {
    my ($colorValue) = @_;
    print "${OSC}5;0;${colorValue}${ST}";
}
sub setUnderline {
    my ($colorValue) = @_;
    print "${OSC}5;1;${colorValue}${ST}";
}
sub setBlink {
    my ($colorValue) = @_;
    print "${OSC}5;2;${colorValue}${ST}";
}
sub setReverse {
    my ($colorValue) = @_;
    print "${OSC}5;3;${colorValue}${ST}";
}
sub setItalic {
    my ($colorValue) = @_;
    print "${OSC}5;4;${colorValue}${ST}";
}
