#!/usr/bin/env bash
set -o errexit
set -o nounset
set -o pipefail

main () {
    ALT_EMACS_DIR="$HOME/.altemacs.d"

    PROGNAME="$(basename "$0")"
    if [[ "$PROGNAME" = "altemacs" ]] ; then
        if ! (( $# )) ; then
            >&2 echo "$PROGNAME: requires initial <name> argument"
            exit 1
        fi
        ALT_EMACS_NAME="$1"
        shift
    else
        ALT_EMACS_NAME="${PROGNAME}"
    fi

    export EMACS_USER_DIRECTORY="${ALT_EMACS_DIR}/${ALT_EMACS_NAME}"
    mkdir -p "${EMACS_USER_DIRECTORY}"
    touch "${EMACS_USER_DIRECTORY}/init.el"
    exec emacs "${@}"
}

main "$@"
